// Prisma Schema for Daddy Jobe Comprehensive School Website
// This schema includes models for user activity tracking, contact submissions, and more

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // Using SQLite for development (no server setup required)
  // For production, change to "postgresql" or "mysql"
  // provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Activity Tracking Model
// Tracks all user interactions on the website
model UserActivity {
  id        String   @id @default(cuid())
  userId    String?  // Optional: for authenticated users
  sessionId String   // Track user sessions
  action    String   // Type of action: 'page_view', 'click', 'form_submit', 'download', etc.
  path      String   // URL path where action occurred
  referrer  String?  // HTTP referrer
  userAgent String?  // User agent string
  ipAddress String?  // IP address (may be null in production due to proxies)
  metadata  Json?    // Additional action-specific data
  timestamp DateTime @default(now())
  
  // Indexes for performance
  @@index([timestamp])
  @@index([action])
  @@index([path])
  @@index([sessionId])
  @@index([userId])
  @@map("user_activities")
}

// Contact Form Submissions
model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  
  @@map("contact_submissions")
}

// Admin Users Model (for authentication)
model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed password
  name      String
  role      String   @default("admin") // 'admin', 'super_admin'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("admins")
}

// Session Tracking (for analytics)
model UserSession {
  id        String   @id @default(cuid())
  sessionId String   @unique
  userId    String?
  ipAddress String?
  userAgent String?
  referrer  String?
  startedAt DateTime @default(now())
  endedAt   DateTime?
  duration  Int?      // Duration in seconds
  
  @@index([sessionId])
  @@index([startedAt])
  @@map("user_sessions")
}

// ============================================
// CMS Models - Content Management System
// ============================================

// Blog Posts
model BlogPost {
  id            String   @id @default(cuid())
  slug          String   @unique
  title         String
  excerpt       String
  content       String
  image         String
  category      String
  tags          String   // JSON array stored as string (SQLite limitation)
  author        String
  authorRole    String?
  publishedDate DateTime
  readTime      Int      // in minutes
  featured      Boolean  @default(false)
  published     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String   // Admin ID
  updatedBy     String?  // Admin ID
  
  @@index([slug])
  @@index([category])
  @@index([published])
  @@index([publishedDate])
  @@index([featured])
  @@map("blog_posts")
}

// Staff Members
model StaffMember {
  id            String   @id @default(cuid())
  name          String
  role          String   // "Faculty", "Administrative", etc.
  department    String?
  position      String
  bio           String
  image         String?
  email         String?
  phone         String?
  qualifications String  // JSON array stored as string (SQLite limitation)
  experience    Int?     // Years of experience
  order         Int      @default(0) // For sorting
  published     Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String   // Admin ID
  
  @@index([role])
  @@index([published])
  @@index([order])
  @@index([department])
  @@map("staff_members")
}

// News & Events
model NewsEvent {
  id            String   @id @default(cuid())
  slug          String   @unique
  title         String
  excerpt       String
  content       String
  image         String?
  type          String   // "news" or "event"
  eventDate     DateTime?
  location      String?
  published     Boolean  @default(false)
  featured      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String   // Admin ID
  
  @@index([type])
  @@index([published])
  @@index([eventDate])
  @@index([featured])
  @@index([slug])
  @@map("news_events")
}

// Gallery Items
model GalleryItem {
  id            String   @id @default(cuid())
  title         String
  description   String?
  image         String
  category      String   // "events", "sports", "academics", etc.
  order         Int      @default(0)
  published     Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String   // Admin ID
  
  @@index([category])
  @@index([published])
  @@index([order])
  @@map("gallery_items")
}

// Page Content (for managing home page sections, etc.)
model PageContent {
  id            String   @id @default(cuid())
  page          String   // "home", "about", "academics", etc.
  section       String   // "hero", "about", "stats", etc.
  content       String   // JSON stored as string (SQLite limitation)
  order         Int      @default(0) // For section ordering
  visible       Boolean  @default(true) // Section visibility toggle
  published     Boolean  @default(true) // Published/draft status
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  @@unique([page, section])
  @@index([page])
  @@index([published])
  @@index([order])
  @@index([visible])
  @@map("page_contents")
}

// Site Settings (for global configuration)
model SiteSetting {
  id            String   @id @default(cuid())
  key           String   @unique
  value         String
  type          String   // "text", "number", "boolean", "json", "url", "email", "image"
  category      String   @default("general") // "general", "contact", "social", "links", "theme"
  description   String?
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  @@index([key])
  @@index([category])
  @@map("site_settings")
}

// ============================================
// CMS Enhancement Models
// ============================================

// Media Assets (centralized media library)
model MediaAsset {
  id            String   @id @default(cuid())
  filename      String
  originalName  String
  url           String
  path          String
  folder        String   // "blog", "staff", "gallery", "news", "pages"
  mimeType      String
  size          Int      // in bytes
  width         Int?     // for images
  height        Int?     // for images
  altText       String?
  title         String?
  description   String?
  tags          String?  // JSON array stored as string
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  uploadedBy    String   // Admin ID
  
  @@index([folder])
  @@index([mimeType])
  @@index([uploadedBy])
  @@map("media_assets")
}

// Navigation Items
model NavigationItem {
  id            String   @id @default(cuid())
  label         String
  href          String
  order         Int      @default(0)
  visible       Boolean  @default(true)
  parentId      String?  // For submenu items (max 1 level deep)
  icon          String?  // Optional icon name
  target        String   @default("_self") // _self, _blank
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  @@index([order])
  @@index([parentId])
  @@index([visible])
  @@map("navigation_items")
}

// Footer Sections
model FooterSection {
  id            String   @id @default(cuid())
  type          String   // "quick_links", "programs", "custom"
  title         String
  order         Int      @default(0)
  visible       Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  links         FooterLink[]
  
  @@index([order])
  @@index([type])
  @@map("footer_sections")
}

// Footer Links
model FooterLink {
  id            String   @id @default(cuid())
  sectionId     String
  label         String
  href          String
  order         Int      @default(0)
  visible       Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  section       FooterSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  
  @@index([sectionId])
  @@index([order])
  @@map("footer_links")
}

// Feature Flags / Toggles
model FeatureToggle {
  id            String   @id @default(cuid())
  key           String   @unique // "search", "blog", "gallery", "events_carousel", "testimonials", etc.
  enabled       Boolean  @default(true)
  description   String?
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  @@index([key])
  @@map("feature_toggles")
}

// Testimonials
model Testimonial {
  id            String   @id @default(cuid())
  name          String
  role          String
  text          String
  image         String?  // URL to media asset
  featured      Boolean  @default(false)
  order         Int      @default(0)
  published     Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String   // Admin ID
  
  @@index([featured])
  @@index([published])
  @@index([order])
  @@map("testimonials")
}

// Statistics (for TileGrid section)
model Statistic {
  id            String   @id @default(cuid())
  number        Int
  suffix        String?  // "+", "%", etc.
  title         String
  description   String
  icon          String   // Icon name from lucide-react
  bgColor       String   // CSS color class
  textColor     String   // CSS color class
  order         Int      @default(0)
  visible       Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  @@index([order])
  @@index([visible])
  @@map("statistics")
}

// Page SEO (meta tags per page)
model PageSEO {
  id            String   @id @default(cuid())
  page          String   // Page path (e.g., "/", "/about")
  title         String
  description   String
  keywords      String?  // Comma-separated
  ogImage       String?  // URL to media asset
  ogType        String?  // "website", "article", etc.
  twitterCard   String?  // "summary", "summary_large_image"
  canonicalUrl  String?  // Custom canonical URL
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  updatedBy     String   // Admin ID
  
  @@unique([page])
  @@index([page])
  @@map("page_seo")
}

// Audit Log (for tracking all admin actions)
model AuditLog {
  id            String   @id @default(cuid())
  adminId       String   // Admin ID who performed the action
  action        String   // "create", "update", "delete", "publish", "unpublish", etc.
  resource      String   // "PageContent", "MediaAsset", "NavigationItem", etc.
  resourceId   String?  // ID of the resource
  before        String?  // JSON of previous state (for updates)
  after         String?  // JSON of new state (for creates/updates)
  ipAddress     String?
  userAgent     String?
  timestamp     DateTime @default(now())
  
  @@index([adminId])
  @@index([resource])
  @@index([timestamp])
  @@index([action])
  @@map("audit_logs")
}
